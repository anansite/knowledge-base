<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知识库 - 技术文档中心</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #24292e;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .sidebar {
            width: 320px;
            background: #fff;
            border-right: 1px solid #e1e4e8;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            position: relative;
        }

        .sidebar-resizer {
            position: absolute;
            right: -5px;
            top: 0;
            width: 10px;
            height: 100%;
            cursor: col-resize;
            background: transparent;
            z-index: 1000;
        }

        .sidebar-resizer:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .sidebar-resizer:active {
            background: rgba(102, 126, 234, 0.2);
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            z-index: 1000;
        }

        .sidebar-toggle:hover {
            background: #bbdefb;
            color: #1565c0;
            border-color: #90caf9;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .sidebar-toggle i {
            transition: transform 0.3s ease;
        }



        .sidebar-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e1e4e8;
            background: linear-gradient(135deg, #667eea 0%, #9c88ff 100%);
            color: #fff;
        }

        .sidebar-header h1 {
            font-size: 20px;
            color: #fff;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .sidebar-header p {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            opacity: 0.9;
        }

        .search-container {
            padding: 12px 20px;
            border-bottom: 1px solid #e1e4e8;
            background: #fafbfc;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 2px solid #e1e4e8;
            border-radius: 6px;
            font-size: 14px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 13px;
        }

        .stats {
            padding: 12px 20px;
            font-size: 12px;
            color: #586069;
            background: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
            font-weight: 500;
        }

        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .tree-item {
            padding: 8px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tree-item:hover {
            background-color: #f8f9fa;
            transform: translateX(3px);
        }

        .tree-item:hover .name {
            color: #1a202c;
        }

        .tree-item.active {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #3730a3;
            box-shadow: 0 2px 12px rgba(99, 102, 241, 0.15);
            border-left: 3px solid #6366f1;
        }

        .tree-item .icon {
            font-size: 12px;
            flex-shrink: 0;
            width: 16px;
            text-align: center;
        }

        .tree-item .icon i.fa-file-alt {
            color: #3b82f6;
        }

        .tree-item:hover .icon i.fa-file-alt {
            color: #2563eb;
        }

        .tree-item.active .icon i.fa-file-alt {
            color: #3730a3;
        }

        .tree-item .content {
            flex: 1;
            min-width: 0;
        }

        .tree-item .name {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #2d3748;
        }

        .tree-item .path {
            font-size: 10px;
            color: #586069;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tree-item.active .path {
            color: rgba(55, 48, 163, 0.7);
        }

        .tree-item .meta {
            font-size: 9px;
            color: #8b949e;
            margin-top: 1px;
        }

        .tree-item.active .meta {
            color: rgba(55, 48, 163, 0.6);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
            position: relative;
            transition: margin-left 0.3s ease;
        }

        .sidebar.collapsed + .main-content {
            margin-left: -320px;
        }

        .viewer-header {
            padding: 8px 20px;
            border-bottom: 1px solid #e1e4e8;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .viewer-header-left {
            flex: 1;
        }

        .header-main {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .header-secondary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .viewer-header h2 {
            color: #24292e;
            font-size: 16px;
            margin-bottom: 0;
            font-weight: 600;
            flex-shrink: 0;
        }

        .viewer-header .file-path {
            color: #586069;
            font-size: 11px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            margin-bottom: 3px;
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            display: inline-block;
        }

        .viewer-header .file-meta {
            color: #8b949e;
            font-size: 10px;
        }

        .file-details {
            margin-top: 0;
        }

        .file-info {
            font-size: 10px;
            color: #8b949e;
            line-height: 1.3;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .file-info span {
            display: flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
        }

        .file-info i {
            color: #667eea;
            width: 10px;
            text-align: center;
            font-size: 9px;
        }

        .viewer-actions {
            display: none;
            gap: 6px;
            align-items: center;
        }

        .viewer-actions.show {
            display: flex;
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            padding: 3px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 9px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .action-btn.secondary {
            background: #f6f8fa;
            color: #586069;
            border: 1px solid #e1e4e8;
        }

        .action-btn.secondary:hover {
            background: #e1e4e8;
            color: #24292e;
        }

        .viewer-content {
            flex: 1;
            padding: 20px 25px;
            overflow-y: auto;
            background: #fff;
        }

        .markdown-content {
            line-height: 1.7;
            max-width: 100%;
            color: #24292e;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            text-align: left;
        }

        /* 使用GitHub样式覆盖列表问题 */
        .markdown-body ul,
        .markdown-body ol {
            padding-left: 2em;
        }

        .markdown-body ul {
            list-style-type: disc;
        }

        .markdown-body ol {
            list-style-type: decimal;
        }

        .markdown-content * {
            box-sizing: border-box;
        }

        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3,
        .markdown-content h4,
        .markdown-content h5,
        .markdown-content h6 {
            margin-top: 40px;
            margin-bottom: 24px;
            font-weight: 700;
            line-height: 1.3;
            color: #24292e;
            position: relative;
        }

        .markdown-content h1 {
            font-size: 2.2em;
            border-bottom: 4px solid #667eea;
            padding-bottom: 0.5em;
            color: #24292e;
            margin-top: 0;
            margin-bottom: 28px;
            position: relative;
        }

        .markdown-content h1::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .markdown-content h2 {
            font-size: 1.7em;
            border-bottom: 3px solid #e1e4e8;
            padding-bottom: 0.4em;
            color: #24292e;
            margin-top: 32px;
        }

        .markdown-content h3 {
            font-size: 1.3em;
            color: #24292e;
            margin-top: 28px;
            padding-left: 16px;
            border-left: 3px solid #667eea;
        }

        .markdown-content h4 {
            font-size: 1.1em;
            color: #24292e;
            margin-top: 24px;
        }

        .markdown-content h5 {
            font-size: 1em;
            color: #586069;
            margin-top: 20px;
        }

        .markdown-content h6 {
            font-size: 0.9em;
            color: #8b949e;
            margin-top: 18px;
        }

        .markdown-content p {
            margin-bottom: 20px;
            color: #24292e;
            text-align: justify;
            line-height: 1.7;
        }

        /* 确保所有代码元素都没有下划线和阴影 */
        .markdown-content code,
        .markdown-content pre code,
        .markdown-content .token,
        .markdown-content .prism-code,
        .markdown-content pre {
            text-decoration: none !important;
            border-bottom: none !important;
            box-shadow: none !important;
            text-shadow: none !important;
        }

        /* 代码块复制按钮样式 - 扁平化设计 */
        .code-block-wrapper {
            position: relative;
            margin: 24px 0;
        }

        .copy-button {
            position: absolute;
            top: 6px;
            right: 6px;
            background: #f6f8fa;
            color: #586069;
            border: 1px solid #e1e4e8;
            border-radius: 1px;
            padding: 0;
            font-size: 5px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 400;
            line-height: 1;
            width: 10px;
            height: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: scale(1);
        }

        .copy-button:hover {
            background: #e1e4e8;
            color: #24292e;
            transform: scale(1.1);
        }

        .copy-button:active {
            transform: scale(0.95);
        }

        .copy-button i {
            font-size: 4px;
            margin-right: 0;
        }

        .code-block-wrapper:hover .copy-button {
            opacity: 1;
        }

        .copy-button:hover {
            background: #e1e4e8;
            color: #24292e;
        }

        .copy-button.copied {
            background: #28a745;
            color: white;
            border-color: #28a745;
            transform: scale(1.2);
            animation: copySuccess 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes copySuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.2); }
        }

        .markdown-content code {
            background: linear-gradient(135deg, #f6f8fa 0%, #e9ecef 100%);
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 85%;
            margin: 0 3px;
            padding: 3px 6px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, 'Courier New', monospace;
            color: #e36209;
            font-weight: 500;
            box-shadow: none !important;
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .markdown-content pre {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            font-size: 12px;
            line-height: 1.5;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 20px 20px 20px 20px;
            margin: 24px 0;
            border: 1px solid #e1e4e8;
            box-shadow: none !important;
            position: relative;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .markdown-content pre::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px 12px 0 0;
        }

        .markdown-content pre code {
            background-color: transparent;
            padding: 0;
            color: #24292e;
            border: none;
            margin: 0;
            font-size: 12px;
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .markdown-content blockquote {
            border-left: 5px solid #667eea;
            color: #6a737d;
            margin: 28px 0;
            padding: 20px 24px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 0 12px 12px 0;
            font-style: italic;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .markdown-content blockquote::before {
            content: '"';
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 2.5em;
            color: #667eea;
            opacity: 0.3;
            font-family: serif;
        }

        .markdown-content table {
            border-collapse: collapse;
            border-spacing: 0;
            margin: 28px 0;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            border: 1px solid #e1e4e8;
        }

        .markdown-content table th,
        .markdown-content table td {
            border: 1px solid #dfe2e5;
            padding: 16px 20px;
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .markdown-content table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .markdown-content table td {
            background: #fff;
            font-size: 12px;
            line-height: 1.5;
        }

        .markdown-content table tr:nth-child(even) td {
            background: #f8f9fa;
        }

        .markdown-content table tr:hover td {
            background: #f1f3f4;
            transition: background-color 0.3s ease;
        }

        /* 使用GitHub Markdown样式，调整宽度以铺满页面 */
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 100%;
            margin: 0;
            padding: 20px 25px;
            width: 100%;
        }

        .markdown-content strong {
            font-weight: 700;
            color: #24292e;
            background: linear-gradient(120deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .markdown-content em {
            font-style: italic;
            color: #586069;
            background: rgba(102, 126, 234, 0.05);
            padding: 1px 3px;
            border-radius: 2px;
        }

        .markdown-content a {
            color: #667eea;
            text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .markdown-content a:hover {
            border-bottom: 2px solid #667eea;
            color: #5a67d8;
            background: rgba(102, 126, 234, 0.05);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .markdown-content hr {
            border: none;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 40px 0;
            border-radius: 2px;
            position: relative;
        }

        .markdown-content hr::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 0 2px #667eea;
        }

        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            margin: 24px 0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .markdown-content img:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.2);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #586069;
        }

        .loading i {
            font-size: 20px;
            color: #667eea;
            margin-bottom: 12px;
        }

        .error {
            text-align: center;
            padding: 60px;
            color: #cb2431;
        }

        .error i {
            font-size: 40px;
            color: #cb2431;
            margin-bottom: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #586069;
        }

        .empty-state i {
            font-size: 40px;
            color: #667eea;
            margin-bottom: 16px;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: #8b949e;
            font-style: italic;
        }

        .folder-structure {
            display: flex;
            flex-direction: column;
        }

        .folder-item {
            border-bottom: 1px solid #f1f3f4;
        }

        .folder-header {
            padding: 8px 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 6px 6px 0 0;
        }

        .folder-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            color: #343a40;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .folder-content {
            display: none;
        }

        .folder-content.expanded {
            display: block;
        }

        .folder-icon {
            transition: transform 0.2s ease;
            color: #6366f1;
        }

        .folder-header:hover .folder-icon {
            color: #4f46e5;
        }

        .folder-content .tree-item {
            margin-left: 20px;
            padding-left: 12px;
        }

        .folder-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .folder-icon {
            transition: all 0.3s ease;
            color: #6366f1;
        }

        .folder-header:hover .folder-icon {
            color: #4f46e5;
        }

        /* 跳转到顶部按钮样式 */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.25);
        }

        .back-to-top.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .back-to-top:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.35);
        }

        .back-to-top:active {
            transform: translateY(-1px);
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
        }

        .folder-toggle i.fa-folder {
            color: #f59e0b;
        }

        .folder-toggle:hover i.fa-folder {
            color: #d97706;
        }

        .folder-icon.expanded {
            transform: rotate(90deg);
        }

        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .share-modal.show {
            display: flex;
        }

        .share-content {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
        }

        .share-content h3 {
            margin-bottom: 16px;
            color: #24292e;
        }

        .share-url {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 16px;
            font-family: monospace;
            word-break: break-all;
            font-size: 12px;
        }

        .share-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 40vh;
            }
            
            .main-content {
                height: 60vh;
            }

            .viewer-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .viewer-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f3f4;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c8cd;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8b3b9;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .markdown-content {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-resizer" id="sidebarResizer"></div>
            <div class="sidebar-header">
                <h1><i class="fas fa-book-open"></i> 知识库</h1>
                <p>技术文档中心 - 探索知识的海洋</p>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="搜索文档..." />
                </div>
            </div>
            
            <div class="stats" id="stats">
                <i class="fas fa-info-circle"></i> 正在加载文件列表...
            </div>
            
            <div class="file-tree" id="fileTree"></div>
        </div>
        
        <div class="main-content">
            
            <div class="viewer-header">
                <div class="viewer-header-left">
                    <div class="header-main">
                        <h2 id="currentFileName"><i class="fas fa-file-alt"></i> <span id="selectedFileName">选择文件查看内容</span></h2>
                    </div>
                    <div class="header-secondary">
                        <div class="file-details" id="currentFileDetails" style="display: none;">
                            <div class="file-info">
                                <span><i class="fas fa-calendar-alt"></i> 创建: <span id="fileCreated"></span></span>
                                <span><i class="fas fa-clock"></i> 修改: <span id="fileModified"></span></span>
                                <span><i class="fas fa-weight-hanging"></i> 大小: <span id="fileSize"></span></span>
                                <span><i class="fas fa-code"></i> 类型: <span id="fileType"></span></span>
                            </div>
                        </div>
                        <div class="viewer-actions" id="viewerActions">
                            <button class="action-btn" id="downloadBtn" onclick="downloadFile()">
                                <i class="fas fa-download"></i> 下载
                            </button>
                            <button class="action-btn secondary" id="shareBtn" onclick="shareFile()">
                                <i class="fas fa-share-alt"></i> 分享
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="viewer-content">
                <div id="markdownContent" class="empty-state">
                    <i class="fas fa-hand-pointer"></i>
                    <h3>欢迎来到知识库</h3>
                    <p>请从左侧选择一个文档开始阅读</p>
                </div>
                <!-- 跳转到顶部按钮 -->
                <button id="backToTop" class="back-to-top" title="回到顶部">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 侧边栏切换按钮 -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-chevron-left"></i>
    </button>

    <!-- 分享模态框 -->
    <div class="share-modal" id="shareModal">
        <div class="share-content">
            <h3><i class="fas fa-share-alt"></i> 分享文档</h3>
            <div class="share-url" id="shareUrl"></div>
            <div class="share-actions">
                <button class="action-btn secondary" onclick="copyShareUrl()">
                    <i class="fas fa-copy"></i> 复制链接
                </button>
                <button class="action-btn secondary" onclick="closeShareModal()">
                    <i class="fas fa-times"></i> 关闭
                </button>
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.4.0/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // 初始化跳转到顶部按钮功能
        function initBackToTopButton() {
            const backToTopBtn = document.getElementById('backToTop');
            const viewerContent = document.querySelector('.viewer-content');
            
            if (!backToTopBtn || !viewerContent) {
                console.warn('跳转到顶部按钮初始化失败:', { backToTopBtn, viewerContent });
                return;
            }

            console.log('跳转到顶部按钮初始化成功');

            // 监听滚动事件
            viewerContent.addEventListener('scroll', () => {
                const scrollTop = viewerContent.scrollTop;
                if (scrollTop > 200) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });

            // 点击按钮滚动到顶部
            backToTopBtn.addEventListener('click', () => {
                viewerContent.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        class MarkdownViewer {
            constructor() {
                this.files = [];
                this.currentFile = null;
                this.folderStructure = {};
                this.init();
            }

            async init() {
                await this.loadFileList();
                this.buildFolderStructure();
                this.renderFileTree();
                this.bindEvents();
                
                // 尝试恢复上次打开的文件
                setTimeout(() => {
                    this.loadLastFile();
                }, 100);
            }

            async loadFileList() {
                try {
                    // 尝试加载自动生成的文件列表
                    const response = await fetch('project-files/file-list.json?v=' + Date.now());
                    if (response.ok) {
                        const fileListData = await response.json();
                        console.log('加载的文件列表内容:', fileListData);
                        
                        if (fileListData && fileListData.files) {
                            console.log('原始文件列表:', fileListData.files);
                            // 过滤掉README.md文件
                            this.files = fileListData.files.filter(file => 
                                !file.name.toLowerCase().includes('readme')
                            );
                            console.log('过滤后的文件列表:', this.files);
                            console.log(`✅ 已加载 ${this.files.length} 个文件`);
                        } else {
                            throw new Error('文件列表格式错误');
                        }
                    } else {
                        throw new Error('无法加载文件列表');
                    }
                } catch (error) {
                    console.warn('自动加载文件列表失败，使用默认列表:', error.message);
                    // 使用默认文件列表作为后备
                    this.files = [
                        {
                            name: 'MySQL锁机制详解.md',
                            path: 'mysql/MySQL锁机制详解.md',
                            type: 'file',
                            size: 0,
                            modified: new Date().toISOString()
                        },
                        {
                            name: 'MySQL锁机制详解 copy.md',
                            path: 'mysql/MySQL锁机制详解 copy.md',
                            type: 'file',
                            size: 0,
                            modified: new Date().toISOString()
                        }
                    ];
                }
                
                this.updateStats();
            }

            buildFolderStructure() {
                this.folderStructure = {};
                
                this.files.forEach(file => {
                    const pathParts = file.path.split('/');
                    let currentLevel = this.folderStructure;
                    
                    // 构建文件夹结构
                    for (let i = 0; i < pathParts.length - 1; i++) {
                        const part = pathParts[i];
                        if (!currentLevel[part]) {
                            currentLevel[part] = { files: [], folders: {} };
                        }
                        currentLevel = currentLevel[part].folders;
                    }
                    
                    // 添加文件到当前级别
                    const fileName = pathParts[pathParts.length - 1];
                    currentLevel[fileName] = file;
                });
            }

            updateStats() {
                const statsDiv = document.getElementById('stats');
                const totalFiles = this.files.length;
                const totalSize = this.files.reduce((sum, file) => sum + (file.size || 0), 0);
                const sizeKB = Math.round(totalSize / 1024);
                
                statsDiv.innerHTML = `<i class="fas fa-chart-bar"></i> 共 ${totalFiles} 个文档 (${sizeKB} KB)`;
            }

            renderFileTree() {
                const fileTree = document.getElementById('fileTree');
                fileTree.innerHTML = '';

                if (this.files.length === 0) {
                    fileTree.innerHTML = '<div class="no-results"><i class="fas fa-folder-open"></i><br>没有找到Markdown文件</div>';
                    return;
                }

                this.renderFolderStructure(this.folderStructure, fileTree, '');
            }

            renderFolderStructure(structure, container, currentPath) {
                Object.keys(structure).forEach(key => {
                    const item = structure[key];
                    
                    if (item.type === 'file' || item.path) {
                        // 这是一个文件
                        this.renderFileItem(item, container);
                    } else {
                        // 这是一个文件夹
                        this.renderFolderItem(key, item, container, currentPath);
                    }
                });
            }

            renderFileItem(file, container) {
                const item = document.createElement('div');
                item.className = 'tree-item';
                item.dataset.path = file.path;
                
                const size = file.size ? this.formatFileSize(file.size) : '';
                const modified = file.modified ? this.formatDate(file.modified) : '';
                
                // 根据文件类型选择图标
                const icon = this.getFileIcon(file.name);
                
                item.innerHTML = `
                    <span class="icon">${icon}</span>
                    <div class="content">
                        <div class="name">${file.name}</div>
                        <div class="meta">${size}${modified ? ' • ' + modified : ''}</div>
                    </div>
                `;
                
                container.appendChild(item);
            }

            getFileIcon(fileName) {
                const ext = fileName.toLowerCase().split('.').pop();
                switch (ext) {
                    case 'md':
                        return '<i class="fas fa-file-alt"></i>';
                    case 'txt':
                        return '<i class="fas fa-file-text"></i>';
                    case 'pdf':
                        return '<i class="fas fa-file-pdf"></i>';
                    case 'doc':
                    case 'docx':
                        return '<i class="fas fa-file-word"></i>';
                    case 'xls':
                    case 'xlsx':
                        return '<i class="fas fa-file-excel"></i>';
                    case 'ppt':
                    case 'pptx':
                        return '<i class="fas fa-file-powerpoint"></i>';
                    default:
                        return '<i class="fas fa-file"></i>';
                }
            }

            renderFolderItem(folderName, folderData, container, currentPath) {
                const folderDiv = document.createElement('div');
                folderDiv.className = 'folder-item';
                
                const folderHeader = document.createElement('div');
                folderHeader.className = 'folder-header folder-toggle';
                folderHeader.innerHTML = `
                    <div class="folder-toggle">
                        <i class="fas fa-chevron-right folder-icon"></i>
                        <i class="fas fa-folder"></i>
                        <span>${folderName}</span>
                    </div>
                `;
                
                const folderContent = document.createElement('div');
                folderContent.className = 'folder-content';
                
                folderDiv.appendChild(folderHeader);
                folderDiv.appendChild(folderContent);
                container.appendChild(folderDiv);
                
                // 绑定文件夹展开/收起事件 - 手风琴效果
                folderHeader.addEventListener('click', () => {
                    const icon = folderHeader.querySelector('.folder-icon');
                    const content = folderContent;
                    
                    if (content.classList.contains('expanded')) {
                        // 如果当前文件夹已展开，则折叠它
                        content.classList.remove('expanded');
                        icon.classList.remove('expanded');
                    } else {
                        // 先折叠所有其他文件夹
                        const allFolders = document.querySelectorAll('.folder-item');
                        allFolders.forEach(folder => {
                            if (folder !== folderDiv) {
                                const otherContent = folder.querySelector('.folder-content');
                                const otherIcon = folder.querySelector('.folder-icon');
                                if (otherContent && otherIcon) {
                                    otherContent.classList.remove('expanded');
                                    otherIcon.classList.remove('expanded');
                                }
                            }
                        });
                        
                        // 展开当前文件夹
                        content.classList.add('expanded');
                        icon.classList.add('expanded');
                    }
                });
                
                // 递归渲染子文件夹和文件
                this.renderFolderStructure(folderData.folders, folderContent, currentPath + '/' + folderName);
                
                // 渲染当前文件夹中的文件
                Object.keys(folderData).forEach(key => {
                    if (key !== 'folders' && key !== 'files') {
                        const file = folderData[key];
                        if (file.type === 'file' || file.path) {
                            this.renderFileItem(file, folderContent);
                        }
                    }
                });
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
            }

            bindEvents() {
                // 文件树点击事件
                document.getElementById('fileTree').addEventListener('click', (e) => {
                    const item = e.target.closest('.tree-item');
                    if (item) {
                        this.selectFile(item.dataset.path);
                    }
                });

                // 搜索功能
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.filterFiles(e.target.value);
                });

                // 侧边栏折叠功能
                document.getElementById('sidebarToggle').addEventListener('click', () => {
                    const sidebar = document.getElementById('sidebar');
                    const toggleBtn = document.getElementById('sidebarToggle');
                    const icon = toggleBtn.querySelector('i');
                    
                    sidebar.classList.toggle('collapsed');
                    
                    // 根据侧边栏状态切换图标
                    if (sidebar.classList.contains('collapsed')) {
                        icon.className = 'fas fa-chevron-right';
                    } else {
                        icon.className = 'fas fa-chevron-left';
                    }
                });

                // 侧边栏拖动调整宽度功能
                const sidebar = document.getElementById('sidebar');
                const resizer = document.getElementById('sidebarResizer');
                let isResizing = false;
                let startX, startWidth;

                resizer.addEventListener('mousedown', (e) => {
                    isResizing = true;
                    startX = e.clientX;
                    startWidth = parseInt(getComputedStyle(sidebar).width, 10);
                    document.body.style.cursor = 'col-resize';
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;

                    const width = startWidth + (e.clientX - startX);
                    const minWidth = 200;
                    const maxWidth = 500;
                    
                    if (width >= minWidth && width <= maxWidth) {
                        sidebar.style.width = width + 'px';
                    }
                });

                document.addEventListener('mouseup', () => {
                    if (isResizing) {
                        isResizing = false;
                        document.body.style.cursor = '';
                    }
                });
            }

            selectFile(filePath) {
                // 更新选中状态
                document.querySelectorAll('.tree-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-path="${filePath}"]`).classList.add('active');

                // 更新标题显示选中的文件名
                document.getElementById('selectedFileName').textContent = this.getFileName(filePath);

                // 显示下载和分享按钮
                document.getElementById('viewerActions').classList.add('show');

                // 显示文件详情
                this.showFileDetails(filePath);

                // 保存到localStorage
                this.saveCurrentFile(filePath);

                // 加载文件内容
                this.loadFileContent(filePath);
            }

            async loadFileContent(filePath) {
                const contentDiv = document.getElementById('markdownContent');
                const fileNameDiv = document.getElementById('currentFileName');

                contentDiv.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>正在加载文档...</h3>
                    </div>
                `;
                
                try {
                    // 添加knowledgebase前缀到文件路径
                    const fullPath = `knowledgebase/${filePath}`;
                    const response = await fetch(fullPath);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const content = await response.text();
                    
                    // 配置marked选项以优化渲染
                    marked.setOptions({
                        breaks: true,
                        gfm: true,
                        headerIds: true,
                        mangle: false,
                        sanitize: false,
                        smartLists: true,
                        smartypants: true
                    });
                    
                    const htmlContent = marked.parse(content);
                    
                    contentDiv.innerHTML = `<div class="markdown-body markdown-content">${htmlContent}</div>`;
                    
                    // 应用代码高亮
                    if (window.Prism) {
                        Prism.highlightAllUnder(contentDiv);
                    }
                    
                    // 添加代码块复制功能
                    this.addCopyButtonsToCodeBlocks();
                    
                    // 处理锚点跳转
                    this.setupAnchorLinks();
                    
                    this.currentFile = filePath;
                } catch (error) {
                    console.error('加载文件失败:', error);
                    const fullPath = `knowledgebase/${filePath}`;
                    contentDiv.innerHTML = `
                        <div class="error">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>加载失败</h3>
                            <p>无法加载文件: ${fullPath}</p>
                            <p>错误信息: ${error.message}</p>
                            <p>请检查文件是否存在或网络连接是否正常</p>
                        </div>
                    `;
                }
            }

            getFileName(filePath) {
                return filePath;
            }

            setupAnchorLinks() {
                const markdownContent = document.querySelector('.markdown-content');
                if (!markdownContent) return;

                // 处理锚点链接点击
                const anchorLinks = markdownContent.querySelectorAll('a[href^="#"]');
                anchorLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const href = link.getAttribute('href');
                        const targetId = href.substring(1);
                        
                        // 尝试多种方式查找目标元素
                        let targetElement = document.getElementById(targetId);
                        
                        if (!targetElement) {
                            // 尝试查找包含该ID的元素
                            targetElement = document.querySelector(`[id*="${targetId}"]`);
                        }
                        
                        if (!targetElement) {
                            // 尝试通过文本内容查找
                            const headings = markdownContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
                            for (let heading of headings) {
                                const headingText = heading.textContent.trim();
                                if (headingText === targetId) {
                                    targetElement = heading;
                                    break;
                                }
                            }
                        }
                        
                        if (!targetElement) {
                            // 尝试通过链接文本查找
                            const linkText = link.textContent.trim();
                            const headings = markdownContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
                            for (let heading of headings) {
                                const headingText = heading.textContent.trim();
                                if (headingText === linkText) {
                                    targetElement = heading;
                                    break;
                                }
                            }
                        }
                        
                        if (targetElement) {
                            // 滚动到目标元素
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                            
                            // 添加高亮效果
                            targetElement.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
                            setTimeout(() => {
                                targetElement.style.backgroundColor = '';
                            }, 2000);
                        }
                    });
                });

                // 处理页面加载时的锚点跳转
                const hash = window.location.hash;
                if (hash) {
                    const targetId = hash.substring(1);
                    let targetElement = document.getElementById(targetId);
                    
                    if (!targetElement) {
                        targetElement = document.querySelector(`[id*="${targetId}"]`);
                    }
                    
                    if (targetElement) {
                        setTimeout(() => {
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                            targetElement.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
                            setTimeout(() => {
                                targetElement.style.backgroundColor = '';
                            }, 2000);
                        }, 100);
                    }
                }
            }

            showFileDetails(filePath) {
                const file = this.files.find(f => f.path === filePath);
                const detailsDiv = document.getElementById('currentFileDetails');
                
                if (file) {
                    // 显示文件详情区域
                    detailsDiv.style.display = 'block';
                    
                    // 填充文件信息
                    document.getElementById('fileSize').textContent = file.size ? this.formatFileSize(file.size) : '未知';
                    document.getElementById('fileType').textContent = this.getFileType(file.name);
                    
                    // 处理时间信息
                    if (file.modified) {
                        const modifiedDate = new Date(file.modified);
                        document.getElementById('fileModified').textContent = modifiedDate.toLocaleString('zh-CN');
                        document.getElementById('fileCreated').textContent = modifiedDate.toLocaleString('zh-CN');
                    } else {
                        document.getElementById('fileModified').textContent = '未知';
                        document.getElementById('fileCreated').textContent = '未知';
                    }
                } else {
                    detailsDiv.style.display = 'none';
                }
            }

            getFileType(fileName) {
                const ext = fileName.toLowerCase().split('.').pop();
                const typeMap = {
                    'md': 'Markdown文档',
                    'txt': '文本文件',
                    'pdf': 'PDF文档',
                    'doc': 'Word文档',
                    'docx': 'Word文档',
                    'xls': 'Excel表格',
                    'xlsx': 'Excel表格',
                    'ppt': 'PowerPoint演示',
                    'pptx': 'PowerPoint演示'
                };
                return typeMap[ext] || '未知类型';
            }

            filterFiles(searchTerm) {
                const items = document.querySelectorAll('.tree-item');
                const folders = document.querySelectorAll('.folder-item');
                const term = searchTerm.toLowerCase();
                let visibleCount = 0;
                
                // 隐藏所有文件夹
                folders.forEach(folder => {
                    folder.style.display = 'none';
                });
                
                items.forEach(item => {
                    const fileName = item.querySelector('.name').textContent.toLowerCase();
                    const filePath = item.dataset.path.toLowerCase();
                    
                    if (fileName.includes(term) || filePath.includes(term)) {
                        item.style.display = 'flex';
                        visibleCount++;
                        
                        // 显示父文件夹
                        let parent = item.closest('.folder-item');
                        while (parent) {
                            parent.style.display = 'block';
                            parent = parent.parentElement.closest('.folder-item');
                        }
                    } else {
                        item.style.display = 'none';
                    }
                });

                // 更新统计信息
                const statsDiv = document.getElementById('stats');
                if (searchTerm) {
                    statsDiv.innerHTML = `<i class="fas fa-search"></i> 显示 ${visibleCount} / ${this.files.length} 个文档`;
                } else {
                    // 恢复所有文件夹显示
                    folders.forEach(folder => {
                        folder.style.display = 'block';
                    });
                    items.forEach(item => {
                        item.style.display = 'flex';
                    });
                    this.updateStats();
                }
            }

            // 添加代码块复制功能
            addCopyButtonsToCodeBlocks() {
                const codeBlocks = document.querySelectorAll('.markdown-content pre');
                
                codeBlocks.forEach((pre, index) => {
                    // 检查是否已经有复制按钮
                    if (pre.parentElement.classList.contains('code-block-wrapper')) {
                        return;
                    }
                    
                    // 创建包装器
                    const wrapper = document.createElement('div');
                    wrapper.className = 'code-block-wrapper';
                    
                    // 创建复制按钮
                    const copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.innerHTML = '<i class="fas fa-copy"></i>';
                    copyButton.title = '复制代码';
                    
                    // 插入包装器
                    pre.parentNode.insertBefore(wrapper, pre);
                    wrapper.appendChild(pre);
                    wrapper.appendChild(copyButton);
                    
                    // 添加复制功能
                    copyButton.addEventListener('click', async () => {
                        const code = pre.textContent || pre.innerText;
                        
                        try {
                            await navigator.clipboard.writeText(code);
                            copyButton.classList.add('copied');
                            copyButton.innerHTML = '<i class="fas fa-check"></i>';
                            
                            setTimeout(() => {
                                copyButton.classList.remove('copied');
                                copyButton.innerHTML = '<i class="fas fa-copy"></i>';
                            }, 2000);
                        } catch (err) {
                            // 降级方案
                            const textArea = document.createElement('textarea');
                            textArea.value = code;
                            document.body.appendChild(textArea);
                            textArea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textArea);
                            
                            copyButton.classList.add('copied');
                            copyButton.innerHTML = '<i class="fas fa-check"></i>';
                            
                            setTimeout(() => {
                                copyButton.classList.remove('copied');
                                copyButton.innerHTML = '<i class="fas fa-copy"></i>';
                            }, 2000);
                        }
                    });
                });
            }

            // 保存当前文件到localStorage
            saveCurrentFile(filePath) {
                try {
                    localStorage.setItem('knowledgeBase_lastFile', filePath);
                    localStorage.setItem('knowledgeBase_lastVisit', new Date().toISOString());
                } catch (error) {
                    console.warn('无法保存到localStorage:', error);
                }
            }

            // 从localStorage加载上次打开的文件
            loadLastFile() {
                try {
                    const lastFile = localStorage.getItem('knowledgeBase_lastFile');
                    const lastVisit = localStorage.getItem('knowledgeBase_lastVisit');
                    
                    if (lastFile && lastVisit) {
                        // 检查文件是否仍然存在
                        const fileExists = this.files.some(file => file.path === lastFile);
                        
                        if (fileExists) {
                            console.log('恢复上次打开的文件:', lastFile);
                            
                            // 展开包含该文件的文件夹
                            this.expandFolderForFile(lastFile);
                            
                            // 选择文件
                            this.selectFile(lastFile);
                            return true;
                        }
                    }
                } catch (error) {
                    console.warn('无法从localStorage加载文件:', error);
                }
                return false;
            }

            // 展开包含指定文件的文件夹
            expandFolderForFile(filePath) {
                const pathParts = filePath.split('/');
                
                // 如果有文件夹层级
                if (pathParts.length > 1) {
                    const folderName = pathParts[0]; // 第一级文件夹
                    
                    // 先折叠所有文件夹
                    const allFolders = document.querySelectorAll('.folder-item');
                    allFolders.forEach(folder => {
                        const content = folder.querySelector('.folder-content');
                        const icon = folder.querySelector('.folder-icon');
                        if (content && icon) {
                            content.classList.remove('expanded');
                            icon.classList.remove('expanded');
                        }
                    });
                    
                    // 查找对应的文件夹元素
                    const folderItems = document.querySelectorAll('.folder-item');
                    folderItems.forEach(folderItem => {
                        const folderHeader = folderItem.querySelector('.folder-header');
                        const folderContent = folderItem.querySelector('.folder-content');
                        const folderIcon = folderItem.querySelector('.folder-icon');
                        
                        if (folderHeader && folderContent && folderIcon) {
                            const folderText = folderHeader.textContent.trim();
                            
                            // 如果找到匹配的文件夹
                            if (folderText === folderName) {
                                // 展开文件夹
                                folderContent.classList.add('expanded');
                                folderIcon.classList.add('expanded');
                                
                                // 如果有二级文件夹，也展开
                                if (pathParts.length > 2) {
                                    const subFolderName = pathParts[1];
                                    const subFolders = folderContent.querySelectorAll('.folder-item');
                                    subFolders.forEach(subFolder => {
                                        const subFolderHeader = subFolder.querySelector('.folder-header');
                                        const subFolderContent = subFolder.querySelector('.folder-content');
                                        const subFolderIcon = subFolder.querySelector('.folder-icon');
                                        
                                        if (subFolderHeader && subFolderContent && subFolderIcon) {
                                            const subFolderText = subFolderHeader.textContent.trim();
                                            
                                            if (subFolderText === subFolderName) {
                                                subFolderContent.classList.add('expanded');
                                                subFolderIcon.classList.add('expanded');
                                            }
                                        }
                                    });
                                }
                            }
                        }
                    });
                }
            }
        }

        // 全局变量存储当前文件路径
        let currentFilePath = null;

        // 下载功能
        function downloadFile() {
            if (!currentFilePath) {
                alert('请先选择一个文档');
                return;
            }
            
            const link = document.createElement('a');
            link.href = currentFilePath;
            link.download = currentFilePath.split('/').pop();
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 分享功能
        function shareFile() {
            if (!currentFilePath) {
                alert('请先选择一个文档');
                return;
            }
            
            const shareUrl = window.location.origin + window.location.pathname + '?file=' + encodeURIComponent(currentFilePath);
            document.getElementById('shareUrl').textContent = shareUrl;
            document.getElementById('shareModal').classList.add('show');
        }

        // 复制分享链接
        function copyShareUrl() {
            const shareUrl = document.getElementById('shareUrl').textContent;
            navigator.clipboard.writeText(shareUrl).then(() => {
                alert('链接已复制到剪贴板');
            }).catch(() => {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = shareUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('链接已复制到剪贴板');
            });
        }

        // 关闭分享模态框
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            const viewer = new MarkdownViewer();
            
            // 重写selectFile方法以更新全局变量
            const originalSelectFile = viewer.selectFile.bind(viewer);
            viewer.selectFile = function(filePath) {
                currentFilePath = filePath;
                originalSelectFile(filePath);
            };

            // 初始化跳转到顶部按钮
            initBackToTopButton();

            // 初始化时隐藏下载和分享按钮
            document.getElementById('viewerActions').classList.remove('show');
            document.getElementById('currentFileDetails').style.display = 'none';
            
            // 初始化时显示默认文本
            document.getElementById('selectedFileName').textContent = '选择文件查看内容';
        });
    </script>
</body>
</html>
